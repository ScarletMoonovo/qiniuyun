# 系统概览

这是一个基于 **Go-Zero 微服务框架** 构建的 AI 角色聊天平台后端系统。用户可以创建个性化的 AI 角色，并通过 **WebSocket**
进行实时对话，支持文本和语音交互，具备长期记忆功能。

---

## 技术栈与依赖

系统采用现代化技术栈，主要依赖如下（参考 `go.mod:5-23`）：

- **Web 框架**：Go-Zero（微服务框架）
- **数据库**：MySQL + Redis（缓存层）
- **向量数据库**：Qdrant（用于记忆检索）
- **LLM 集成**：OpenAI 兼容 API
- **嵌入服务**：Python 嵌入服务（FastAPI）
- **实时通信**：WebSocket（Gorilla WebSocket）
- **TTS**：七牛云TTS
- **SST**：阿里云签发token
- **认证**：JWT Token
- **ORM**：GORM

---

## 系统架构分层设计

1. **应用入口层**  
   系统采用经典分层架构，入口文件负责服务器初始化和路由注册。  
   参考位置：`api.go:18-31`

2. **配置管理层**  
   配置文件采用 **YAML** 格式，支持多种外部服务集成。  
   参考位置：`config.go:9-42`

3. **服务上下文层（依赖注入）**  
   服务上下文统一管理所有依赖组件，采用 **依赖注入模式**。  
   参考位置：`serviceContext.go:19-34`, `serviceContext.go:52-67`

4. **API 路由层**  
   路由模块化设计，支持中间件与分组。  
   参考位置：`routes.go:15-33`

---

## 核心业务模块

1. **用户管理模块**  
   提供注册、登录与信息管理等功能。  
   参考位置：`user.api:8-23`

2. **AI 角色管理模块**  
   支持创建与管理个性化 AI 角色。  
   参考位置：`character.api:9-24`

3. **聊天会话模块**  
   管理用户与 AI 角色的对话会话。  
   参考位置：`chat.api:8-22`

4. **基础服务模块**  
   提供标签管理与文件上传等功能。  
   参考位置：`base.api:8-28`

---

## 核心技术组件

1. **实时聊天引擎**
    - 基于 **WebSocket** 实现，支持流式响应。  
      参考位置：`chatHandler.go:20-46`
    - 聊天逻辑集成记忆检索与 LLM 流式输出。  
      参考位置：`chatLogic.go:116-144`

2. **LLM 集成组件**  
   LLM 客户端支持角色生成与流式对话。  
   参考位置：`llm.go:43-56`, `llm.go:173-185`

3. **向量嵌入与记忆检索**  
   嵌入向量服务支持 AI 角色长期记忆。  
   参考位置：`embedding.go:24-36`, `embedding.go:91-110`

---

## 数据模型设计

### 数据访问层

- 使用 **GORM** 作为 ORM 框架
- 支持缓存与事务管理  
  参考位置：`userModel.go:12-33`

### 模型结构

主要数据模型包括：

- **User**：用户信息
- **Character**：AI 角色信息
- **Session**：聊天会话
- **Message**：聊天消息
- **Tag**：标签系统

---

## 设计原则

1. **分层架构原则**
    - **Handler 层**：处理 HTTP 请求与响应
    - **Logic 层**：实现具体业务逻辑
    - **Model 层**：数据访问与持久化
    - **Common 层**：公共组件与工具

2. **依赖注入原则**  
   通过服务上下文统一管理依赖，便于测试与维护。

3**可扩展性原则**  
   模块化设计，支持水平扩展与功能扩展。

---

## 外部依赖

部署时系统需要以下外部服务支持：

- **MySQL 数据库**：主数据存储（参考 `demo.yaml:11-21`）
- **Redis 缓存**：缓存与会话管理（参考 `demo.yaml:22-28`）
- **Embedding 服务**：独立的 Python Flask 服务，用于文本向量化（参考 `embedding.py:1-17`）

实现docker compose，容器化一键部署。

## Notes

该系统是一个完整的 AI 角色聊天平台，具备以下特点：

- **实时性**：基于 WebSocket 的实时聊天，支持流式响应
- **智能化**：集成 LLM 与向量检索，实现智能对话与记忆功能
- **模块化**：清晰的分层架构与模块划分
- **可扩展**：基于 Go-Zero 微服务框架，支持横向扩展
- **多媒体**：支持文本、语音等多种交互方式

系统设计遵循现代 Web 应用的最佳实践，具有良好的 **可维护性** 与 **扩展性**。